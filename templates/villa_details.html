{% extends 'base.html' %}
{% block content %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<style>
    /* Aapka Original CSS */
    .villa-title-detail {
        background: linear-gradient(45deg, #ff416c, #ff4b2b);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 850; font-size: 2.2rem;
    }
    .carousel-item img { height: 500px; object-fit: cover; border-radius: 20px; }
    @media (max-width: 768px) { .carousel-item img { height: 280px; } .villa-title-detail { font-size: 1.8rem; } }

    .highlight-badge-card { 
        background: #ffffff; border: 1px solid #eee; border-radius: 15px; 
        padding: 12px; text-align: center; box-shadow: 0 4px 10px rgba(0,0,0,0.03);
    }

    /* Availability styling */
    .availability-card { 
        background: #fff; border-radius: 20px; padding: 20px; 
        border: 1px solid #f0f0f0; box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    }
    .flatpickr-day.disabled { 
        background: #fee2e2 !important; color: #ef4444 !important; 
        text-decoration: line-through; opacity: 0.6;
    }

    /* âœ… RULES FIX: Line-by-Line Modern Styling */
    .premium-rules-container { margin-top: 15px; }
    .modern-rule-item { 
        display: flex !important; align-items: flex-start !important; 
        background: #f8f9fa; padding: 12px 15px; border-radius: 12px; 
        margin-bottom: 10px !important; border-left: 4px solid #ff4757;
    }
    .rule-icon-box { color: #ff4757; margin-right: 12px; font-size: 1.1rem; }
    .rule-text-content { font-size: 0.95rem; color: #333; font-weight: 500; }

    /* âœ… PRICE ON REQUEST BLUE FIX */
    .text-request-blue { color: #0d6efd !important; font-weight: 800 !important; }

    .offer-banner { position: absolute; top: 20px; left: 20px; z-index: 10; background: #ff4757; color: white; padding: 5px 15px; border-radius: 50px; font-weight: 800; font-size: 0.8rem; }

    @media (max-width: 767px) {
        .mobile-booking-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 10px 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 1000; display: flex; justify-content: space-between; align-items: center; }
        body { padding-bottom: 70px; }
    }
</style>

<div class="container py-4">
    <div id="villaSlider" class="carousel slide shadow-sm position-relative mb-4" data-bs-ride="carousel" style="border-radius: 20px; overflow: hidden;">
        {% if villa.Original_Price|int > villa.Price|int and villa.Price|int > 0 %}
            <div class="offer-banner">ðŸ”¥ SPECIAL OFFER LIVE</div>
        {% endif %}
        <div class="carousel-inner">
            <div class="carousel-item active"><img src="{{ villa.Image_URL }}" class="d-block w-100" alt="Main"></div>
            {% for img in villa_images %}{% if img != villa.Image_URL %}<div class="carousel-item"><img src="{{ img }}" class="d-block w-100" alt="Gallery"></div>{% endif %}{% endfor %}
        </div>
        <button class="carousel-control-prev" data-bs-target="#villaSlider" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
        <button class="carousel-control-next" data-bs-target="#villaSlider" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
    </div>

    <div class="row">
        <div class="col-md-8">
            <h1 class="villa-title-detail mb-1">{{ villa.Villa_Name }}</h1>
            <p class="text-muted mb-4"><i class="bi bi-geo-alt-fill text-danger"></i> Lonavala, Maharashtra</p>

            <div class="row g-3 mb-5">
                <div class="col-4"><div class="highlight-badge-card"><i class="bi bi-people fs-3 text-primary"></i><div class="fw-bold small mt-1">{{ villa.Guests }} Guests</div></div></div>
                <div class="col-4"><div class="highlight-badge-card"><i class="bi bi-door-open fs-3 text-primary"></i><div class="fw-bold small mt-1">{{ villa.BHK }} BHK</div></div></div>
                <div class="col-4"><div class="highlight-badge-card"><i class="bi bi-water fs-3 text-primary"></i><div class="fw-bold small mt-1">Private Pool</div></div></div>
            </div>

            <div class="availability-card mb-5">
                <h4 class="fw-bold mb-3"><i class="bi bi-calendar-range text-primary me-2"></i>Check Availability</h4>
                <div class="input-group mb-3">
                    <span class="input-group-text bg-white border-end-0"><i class="bi bi-calendar3 text-primary"></i></span>
                    <input type="text" id="check_availability" class="form-control border-start-0 shadow-none bg-white" placeholder="Click to view available dates" readonly>
                </div>
            </div>

            <div class="rules-section mb-5">
                <h4 class="fw-bold mb-3"><i class="bi bi-shield-check text-primary me-2"></i>Guest Guidelines</h4>
                <div class="premium-rules-container">
                    {% if villa.Rules_List %}
                        {% for rule in villa.Rules_List %}
                            <div class="modern-rule-item">
                                <div class="rule-icon-box"><i class="bi bi-info-circle-fill"></i></div>
                                <div class="rule-text-content">{{ rule }}</div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted">Standard house rules apply.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-lg rounded-4 p-4 sticky-top" style="top: 100px; z-index: 10;">
                <h5 class="fw-bold mb-3">Pricing & Booking</h5>
                <div class="mb-3">
                    {% if villa.Price|int == 0 %}
                        <span class="fs-2 text-request-blue">Price on Request</span>
                    {% else %}
                        <span class="fs-1 fw-bold text-primary">â‚¹{{ villa.Price|int }}</span>
                        <span class="text-muted ms-2">/ night</span>
                    {% endif %}
                </div>
                
                <div class="d-grid gap-3 mt-4">
                    <a href="https://wa.me/918830024994?text=Hi,%20I%20am%20interested%20in%20booking%20{{ villa.Villa_Name|urlencode }}" class="btn btn-success rounded-pill py-3 fw-bold shadow-sm">
                        <i class="bi bi-whatsapp me-2"></i>BOOK ON WHATSAPP
                    </a>
                    <a href="/enquiry/{{ villa.Villa_ID }}" class="btn btn-outline-primary rounded-pill py-3 fw-bold">
                        <i class="bi bi-envelope-paper me-2"></i>FILL ENQUIRY FORM
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="mobile-booking-bar d-md-none">
    <div style="flex: 1;">
        {% if villa.Price|int == 0 %}
            <div class="fw-bold fs-5 text-request-blue">Price on Request</div>
        {% else %}
            <div class="fw-bold fs-4 text-primary">â‚¹{{ villa.Price|int }}</div>
        {% endif %}
    </div>
    <div style="display: flex; gap: 10px;">
        <a href="https://wa.me/918830024994?text=I%20want%20to%20book%20{{ villa.Villa_Name|urlencode }}" class="btn btn-success rounded-pill px-4 py-2 fw-bold shadow"><i class="bi bi-whatsapp"></i> BOOK</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const disabledDates = {{ booked_dates | tojson }};
        flatpickr("#check_availability", {
            minDate: "today",
            dateFormat: "Y-m-d",
            disable: disabledDates,
            static: true,
            altInput: true,
            altFormat: "F j, Y"
        });
    });
</script>

{% endblock %}
