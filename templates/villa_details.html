{% extends 'base.html' %}
{% block content %}

<style>
    /* üè∑Ô∏è Discount Tag Style */
    .detail-discount-tag {
        position: absolute; top: 20px; right: 20px; z-index: 99;
        background: #e63946; color: white; padding: 8px 15px;
        border-radius: 12px; font-weight: 800; font-size: 1rem;
        box-shadow: 0 4px 15px rgba(0,0,0,0.3);
    }
    
    /* Carousel height and smooth transition */
    #villaSlider { border-radius: 25px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.15); }
    #villaSlider img { height: 450px; object-fit: cover; }
    
    @media (max-width: 768px) {
        #villaSlider img { height: 300px; }
    }

    /* üñ§ Luxury Footer Styling */
    .final-footer { background: #111; color: #ffffff; padding: 50px 0 20px; text-align: center; margin-top: 60px; border-top: 4px solid #D4AF37; }
    .social-icons a { color: white; font-size: 2rem; margin: 0 15px; transition: 0.3s; display: inline-block; text-decoration: none; }
    .social-icons a:hover { transform: scale(1.2); color: #D4AF37; }
    .footer-bottom { border-top: 1px solid #333; padding-top: 20px; margin-top: 30px; font-size: 0.8rem; color: #888; }
</style>

<div class="container py-4">
    <div id="villaSlider" class="carousel slide position-relative" data-bs-ride="carousel">
        
        {% set current = (villa.Price or 0) | float %}
        {% set original = (villa.Original_Price or 0) | float %}
        {% if original > current and current > 0 %}
            {% set disc = (((original - current) / original) * 100) | round | int %}
            <div class="detail-discount-tag">{{ disc }}% OFF</div>
        {% endif %}

        <div class="carousel-inner">
            {% if villa_images %}
                {% for img_link in villa_images %}
                <div class="carousel-item {% if loop.first %}active{% endif %}">
                    <img src="{{ img_link }}" class="d-block w-100" alt="Villa Image">
                </div>
                {% endfor %}
            {% else %}
                <div class="carousel-item active">
                    <img src="{{ villa.Image_URL }}" class="d-block w-100" alt="Villa Image">
                </div>
            {% endif %}
        </div>
        
        <button class="carousel-control-prev" type="button" data-bs-target="#villaSlider" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
        <button class="carousel-control-next" type="button" data-bs-target="#villaSlider" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
    </div>

    <div class="mt-4 px-2">
        <div class="d-flex justify-content-between align-items-start mb-2">
            <div>
                <h1 class="fw-bold m-0 text-dark">{{ villa.Villa_Name }}</h1>
                <div class="mt-2">
                    <span class="badge {% if villa.Status == 'Available' %}bg-success{% else %}bg-warning text-dark{% endif %} rounded-pill px-3 py-2">
                        <i class="bi bi-check-circle-fill"></i> {{ villa.Status | default('Available') }}
                    </span>
                    <small class="text-muted ms-3"><i class="bi bi-geo-alt-fill text-danger"></i> Lonavala, Maharashtra</small>
                </div>
            </div>
            
            {% if villa.Offer_End and villa.Offer_End|string != 'nan' and villa.Offer_End != '' %}
            <div class="text-end">
                <div class="badge bg-danger mb-1 shadow-sm px-3">Limited Offer!</div>
                <div class="text-danger fw-bold" style="font-size: 0.9rem;">
                    <i class="bi bi-hourglass-split"></i> <span id="sheet-timer" data-expire="{{ villa.Offer_End }}">Calculating...</span>
                </div>
            </div>
            {% endif %}
        </div>

        <div class="card border-0 bg-white shadow-sm rounded-4 p-4 my-4">
            <div class="row align-items-center">
                <div class="col-md-7">
                    <p class="text-muted mb-1">Exclusive Price</p>
                    <div class="d-flex align-items-center gap-2">
                        {% if villa.Original_Price and villa.Original_Price|string != 'nan' %}
                        <h5 class="text-decoration-line-through text-muted mb-0">‚Çπ{{ villa.Original_Price }}</h5>
                        {% endif %}
                        <h2 class="fw-bold text-primary mb-0">‚Çπ{{ villa.Price }} <small class="text-muted fs-6 fw-normal">/night</small></h2>
                    </div>
                </div>
                <div class="col-md-5 mt-3 mt-md-0">
                    <a href="/enquiry/{{ villa.Villa_ID }}" class="btn btn-primary btn-lg w-100 rounded-pill fw-bold shadow">Book My Villa</a>
                </div>
            </div>
        </div>

        <div class="row mt-4 g-3">
            <div class="col-4 text-center">
                <div class="p-3 bg-light rounded-4">
                    <i class="bi bi- house-door text-primary fs-3"></i>
                    <p class="small mb-0 mt-1">{{ villa.BHK }} BHK</p>
                </div>
            </div>
            <div class="col-4 text-center">
                <div class="p-3 bg-light rounded-4">
                    <i class="bi bi-people text-primary fs-3"></i>
                    <p class="small mb-0 mt-1">{{ villa.Guests }} Guests</p>
                </div>
            </div>
            <div class="col-4 text-center">
                <div class="p-3 bg-light rounded-4">
                    <i class="bi bi-water text-primary fs-3"></i>
                    <p class="small mb-0 mt-1">Pool</p>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="final-footer">
    <div class="container">
        <h4 class="fw-bold mb-4">Connect With MOREVISTAS</h4>
        <div class="social-icons mb-4">
            <a href="https://wa.me/91XXXXXXXXXX" target="_blank"><i class="bi bi-whatsapp"></i></a>
            <a href="#" target="_blank"><i class="bi bi-instagram"></i></a>
            <a href="#" target="_blank"><i class="bi bi-facebook"></i></a>
        </div>
        <p class="px-3 text-muted">Luxury stays, unforgettable memories. Experience Lonavala like never before.</p>
        <div class="footer-bottom">
            <p>¬© 2026 MoreVistas Lonavala. Built for Excellence.</p>
        </div>
    </div>
</footer>

<script>
    function startTimer() {
        const timerElement = document.getElementById('sheet-timer');
        if (!timerElement) return;

        const expireDateStr = timerElement.getAttribute('data-expire');
        const expireDate = new Date(expireDateStr).getTime();

        const x = setInterval(function() {
            const now = new Date().getTime();
            const distance = expireDate - now;

            if (distance < 0) {
                clearInterval(x);
                timerElement.innerHTML = "Offer Expired";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((distance % (1000 * 60)) / 1000);

            timerElement.innerHTML = days + "d " + hours + "h " + minutes + "m " + seconds + "s ";
        }, 1000);
    }
    document.addEventListener('DOMContentLoaded', startTimer);
</script>

{% endblock %}
