{% extends 'base.html' %}

{% block head %}
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
{% endblock %}

{% block content %}

<style>
    /* 1. Top Runner Styling */
    .offer-runner { background: #000; color: #fff; padding: 10px 0; overflow: hidden; white-space: nowrap; border-bottom: 2px solid #D4AF37; }
    .runner-text { display: inline-block; animation: scroll-text 20s linear infinite; font-weight: 700; text-transform: uppercase; }
    @keyframes scroll-text { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
    .app-link { color: #0d6efd !important; text-decoration: none; font-weight: 800; margin: 0 20px; }

    /* ‚úÖ Weather Widget Glassmorphism Style */
    .weather-card {
        background: rgba(255, 255, 255, 0.1);
        backdrop-filter: blur(10px);
        border-radius: 20px;
        color: #1a1a1a;
        transition: 0.3s;
        border: 1px solid rgba(0, 0, 0, 0.1);
        padding: 15px;
    }

    /* Villa Card Styles */
    .villa-card { transition: 0.4s; border-radius: 25px !important; border: none; overflow: hidden; background: #fff; position: relative; box-shadow: 0 5px 15px rgba(0,0,0,0.05); }
    .villa-card:hover { transform: translateY(-10px); box-shadow: 0 20px 40px rgba(0,0,0,0.12) !important; }
    
    /* Sold Out Ribbon */
    .sold-out-ribbon {
        position: absolute; width: 150px; padding: 5px 0;
        background-color: #ff4d4d; color: #fff; font-size: 11px; font-weight: 800;
        text-align: center; text-transform: uppercase; transform: rotate(-45deg);
        left: -35px; top: 20px; z-index: 20; box-shadow: 0 2px 5px rgba(0,0,0,0.2);
    }
    .sold-out-overlay { filter: grayscale(0.8); opacity: 0.7; pointer-events: none; }

    .discount-tag { position: absolute; top: 15px; right: 15px; background: #28a745; color: white; padding: 5px 12px; border-radius: 10px; font-weight: 800; font-size: 0.8rem; z-index: 10; }
</style>

<div class="offer-runner">
    <div class="runner-text">
        <a href="https://drive.google.com/file/d/12cErjJSSzXthfBtjItHf5vLwod7rIdbj/view?usp=drivesdk" class="app-link"><i class="bi bi-android2"></i> üì≤ DOWNLOAD APP</a> |
        {% for villa in villas %}
            {% if villa.Offer and villa.Offer|string != 'nan' %}
               üî• {{ villa.Villa_Name }}: {{ villa.Offer }} | 
            {% endif %}
        {% endfor %}
        üìû CALL: 8830024994
    </div>
</div>

{% if weather %}
<div class="container mt-4">
    <div class="weather-card d-flex align-items-center justify-content-between">
        <div class="d-flex align-items-center">
            <img src="https://openweathermap.org/img/wn/{{ weather.icon }}@2x.png" alt="weather" style="width: 50px;">
            <div class="ms-2">
                <h6 class="fw-bold mb-0">Lonavala Weather</h6>
                <p class="mb-0 small text-muted">{{ weather.desc }}</p>
            </div>
        </div>
        <div class="text-end">
            <h3 class="fw-bold mb-0 text-primary">{{ weather.temp }}¬∞C</h3>
            <span class="badge bg-primary text-white rounded-pill" style="font-size: 0.6rem;">LIVE</span>
        </div>
    </div>
</div>
{% endif %}


<div class="container my-5">
    <div class="row g-4">
        {% for villa in villas %}
        <div class="col-md-6 col-lg-4">
            <div class="card h-100 villa-card {% if villa.get('Status') == 'Sold Out' %}sold-out-overlay{% endif %}">
                <div style="height: 240px; position: relative;">
                    {% if villa.get('Status') == 'Sold Out' %}
                        <div class="sold-out-ribbon">Sold Out</div>
                    {% endif %}
                    
                    <img src="{{ villa.get('Image_URL', '') }}" class="w-100 h-100" style="object-fit: cover;" loading="lazy">
                    
                    {% set current = (villa.get('Price') or 0) | float %}
                    {% set original = (villa.get('Original_Price') or 0) | float %}
                    {% if villa.get('Status') != 'Sold Out' and original > current and current > 0 %}
                        {% set disc = (((original - current) / original) * 100) | round | int %}
                        <div class="discount-tag">{{ disc }}% OFF</div>
                    {% endif %}
                </div>

                <div class="card-body p-4">
                    <h5 class="fw-bold mb-1">{{ villa.get('Villa_Name') }}</h5>
                    <p class="text-muted small mb-3"><i class="bi bi-geo-alt-fill text-danger"></i> Lonavala, MH</p>
                    
                    <div class="d-flex gap-3 mb-3 small fw-bold">
                        <span class="bg-light p-2 rounded"><i class="bi bi-people-fill text-primary"></i> {{ villa.get('Guests') }} Guests</span>
                        <span class="bg-light p-2 rounded"><i class="bi bi-door-open-fill text-primary"></i> {{ villa.get('BHK') }} BHK</span>
                    </div>

                    <div class="pt-3 border-top d-flex align-items-center justify-content-between">
                        <div>
                            {% if current > 0 %}
                                <small class="text-decoration-line-through text-muted d-block">‚Çπ{{ original | int }}</small>
                                <h5 class="m-0 fw-bold text-primary">‚Çπ{{ current | int }}<small class="text-muted fw-normal fs-6">/nt</small></h5>
                            {% else %}
                                <span class="text-primary fw-bold">Contact for Price</span>
                            {% endif %}
                        </div>
                        <div class="d-flex gap-2">
                            {% if villa.get('Status') == 'Sold Out' %}
                                <button class="btn btn-secondary rounded-pill btn-sm" disabled>Sold Out</button>
                            {% else %}
                                <a href="/villa/{{ villa.get('Villa_ID') }}" class="btn btn-dark rounded-pill px-3 btn-sm fw-bold">View</a>
                                <button onclick="shareVilla('{{ villa.get('Villa_Name') }}')" class="btn btn-outline-dark btn-sm rounded-circle"><i class="bi bi-share"></i></button>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<div class="container mb-5">
    <div class="explore-promo text-center p-5 shadow-lg" style="background: linear-gradient(45deg, #1a1a1a, #333); border-radius: 30px; color: white;">
        <h2 class="fw-bold mb-3">Exploring Lonavala?</h2>
        <p class="mb-4">‡§π‡§Æ‡§®‡•á ‡§Ü‡§™‡§ï‡•á ‡§≤‡§ø‡§è ‡§¨‡•á‡§∏‡•ç‡§ü ‡§ü‡•Ç‡§∞‡§ø‡§∏‡•ç‡§ü ‡§™‡•â‡§á‡§Ç‡§ü‡•ç‡§∏ ‡§ï‡•Ä ‡§≤‡§ø‡§∏‡•ç‡§ü ‡§¨‡§®‡§æ‡§à ‡§π‡•à‡•§</p>
        <a href="/explore-lonavala" class="btn btn-primary btn-lg rounded-pill px-5">See All Points <i class="bi bi-map ms-2"></i></a>
    </div>
</div>

<script>
    function shareVilla(name) {
        if (navigator.share) {
            navigator.share({
                title: name,
                text: 'Check out this amazing villa in Lonavala: ' + name,
                url: window.location.href
            });
        } else {
            alert('Sharing not supported on this browser.');
        }
    }
</script>

{% endblock %}
