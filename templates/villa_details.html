{% extends 'base.html' %}
{% block content %}

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

<style>
    /* Aapka Purana CSS (Safe & Intact) */
    .villa-title-detail {
        background: linear-gradient(45deg, #ff416c, #ff4b2b);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 850; font-size: 2.2rem;
    }
    .carousel-item img { height: 500px; object-fit: cover; border-radius: 20px; }
    @media (max-width: 768px) { .carousel-item img { height: 280px; } .villa-title-detail { font-size: 1.8rem; } }

    .highlight-badge-card { 
        background: #ffffff; 
        border: 1px solid #eee; 
        border-radius: 15px; 
        padding: 12px; 
        text-align: center; 
        box-shadow: 0 4px 10px rgba(0,0,0,0.03);
    }

    /* --- CALENDAR STYLING --- */
    .availability-card { 
        background: #fff; border-radius: 20px; padding: 20px; 
        border: 1px solid #f0f0f0; box-shadow: 0 10px 25px rgba(0,0,0,0.05);
    }
    .flatpickr-day.disabled { 
        background: #fee2e2 !important; color: #ef4444 !important; 
        text-decoration: line-through; border-color: transparent !important;
        opacity: 0.6;
    }

    /* âœ… NEW RULES SECTION CSS (Added without breaking old logic) */
    .premium-rules-container { 
        background: #ffffff; 
        border-radius: 20px; 
        padding: 20px; 
        border: 1px solid #f1f4f8;
        box-shadow: 0 10px 30px rgba(0,0,0,0.04);
        margin-top: 20px;
    }

    .modern-rule-item { 
        display: flex !important; 
        align-items: flex-start !important; 
        width: 100% !important; 
        background: #fbfcfe;
        padding: 15px 18px; 
        border-radius: 12px; 
        margin-bottom: 12px !important; 
        border: 1px solid #f1f4f8; 
        transition: 0.3s ease;
    }

    .modern-rule-item:hover { 
        transform: translateX(5px); 
        background: #fff; 
        border-color: #ff4757; 
        box-shadow: 0 5px 15px rgba(0,0,0,0.05); 
    }

    .rule-icon-box { 
        width: 30px; 
        height: 30px; 
        background: rgba(255, 71, 87, 0.1); 
        color: #ff4757; 
        border-radius: 50%; 
        display: flex; 
        align-items: center; 
        justify-content: center; 
        margin-right: 15px; 
        flex-shrink: 0; 
    }

    .rule-text-content { 
        flex: 1;
        font-size: 0.95rem; 
        color: #444; 
        font-weight: 500; 
        line-height: 1.5; 
    }

    .offer-banner { position: absolute; top: 20px; left: 20px; z-index: 10; background: #ff4757; color: white; padding: 5px 15px; border-radius: 50px; font-weight: 800; font-size: 0.8rem; }

    @media (max-width: 767px) {
        .mobile-booking-bar { position: fixed; bottom: 0; left: 0; right: 0; background: white; padding: 10px 20px; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); z-index: 1000; display: flex; justify-content: space-between; align-items: center; }
        body { padding-bottom: 70px; }
    }
</style>

<div class="container py-4">
    <div id="villaSlider" class="carousel slide shadow-sm position-relative mb-4" data-bs-ride="carousel" style="border-radius: 20px; overflow: hidden;">
        {% if villa.Original_Price|int > villa.Price|int and villa.Price|int > 0 %}
            <div class="offer-banner">ðŸ”¥ SPECIAL OFFER LIVE</div>
        {% endif %}
        <div class="carousel-inner">
            <div class="carousel-item active"><img src="{{ villa.Image_URL }}" class="d-block w-100" alt="Main"></div>
            {% for img in villa_images %}{% if img != villa.Image_URL %}<div class="carousel-item"><img src="{{ img }}" class="d-block w-100" alt="Gallery"></div>{% endif %}{% endfor %}
        </div>
        <button class="carousel-control-prev" data-bs-target="#villaSlider" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
        <button class="carousel-control-next" data-bs-target="#villaSlider" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
    </div>

    <div class="row">
        <div class="col-md-8">
            <h1 class="villa-title-detail mb-1">{{ villa.Villa_Name }}</h1>
            <p class="text-muted mb-4"><i class="bi bi-geo-alt-fill text-danger"></i> Lonavala, Maharashtra</p>

            <div class="row g-3 mb-5">
                <div class="col-4"><div class="highlight-badge-card"><i class="bi bi-people fs-3 text-primary"></i><div class="fw-bold small mt-1">{{ villa.Guests }} Guests</div></div></div>
                <div class="col-4"><div class="highlight-badge-card"><i class="bi bi-door-open fs-3 text-primary"></i><div class="fw-bold small mt-1">{{ villa.BHK }} BHK</div></div></div>
                <div class="col-4"><div class="highlight-badge-card"><i class="bi bi-water fs-3 text-primary"></i><div class="fw-bold small mt-1">Private Pool</div></div></div>
            </div>

            <div class="availability-card mb-5">
                <h4 class="fw-bold mb-3"><i class="bi bi-calendar-range text-primary me-2"></i>Check Availability</h4>
                <div class="input-group mb-3">
                    <span class="input-group-text bg-white border-end-0"><i class="bi bi-calendar3 text-primary"></i></span>
                    <input type="text" id="check_availability" class="form-control border-start-0 shadow-none bg-white" placeholder="Click to view available dates" readonly>
                </div>
                <div class="d-flex gap-3 small fw-bold">
                    <span><span style="height:10px; width:10px; background:#ef4444; display:inline-block; border-radius:50%;"></span> Booked</span>
                    <span><span style="height:10px; width:10px; background:#22c55e; display:inline-block; border-radius:50%;"></span> Available</span>
                </div>
            </div>

            <div class="description-section mb-5">
                <h4 class="fw-bold mb-3">âœ¨ Experience Private Pool Luxury</h4>
                <p class="text-secondary" style="line-height: 1.7; font-size: 1.05rem;">
                    Welcome to <b>{{ villa.Villa_Name }}</b> â€” a beautifully designed escape perfect for family and friends.
                </p>
            </div>

            <div class="rules-section mb-5">
                <h4 class="fw-bold mb-4"><i class="bi bi-shield-check text-primary me-2"></i>Guest Guidelines</h4>
                <div class="premium-rules-container">
                    {% if villa.Rules_List %}
                        {% for rule in villa.Rules_List %}
                            <div class="modern-rule-item">
                                <div class="rule-icon-box"><i class="bi bi-check2"></i></div>
                                <div class="rule-text-content">{{ rule }}</div>
                            </div>
                        {% endfor %}
                    {% else %}
                        <p class="text-muted small">Standard house rules apply.</p>
                    {% endif %}
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card border-0 shadow-lg rounded-4 p-4 sticky-top" style="top: 100px; z-index: 10;">
                <h5 class="fw-bold mb-3">Pricing & Booking</h5>
                <div class="mb-3">
                    {% if villa.Price|int == 0 %}
                        <span class="fs-2 fw-bold text-dark">Price on Request</span>
                    {% else %}
                        <span class="fs-1 fw-bold text-primary">â‚¹{{ villa.Price|int }}</span>
                        <span class="text-muted ms-2">/ night</span>
                    {% endif %}
                </div>
                
                <div class="d-grid gap-3 mt-4">
                    <a href="https://wa.me/918830024994?text=Hi,%20I%20am%20interested%20in%20booking%20{{ villa.Villa_Name|urlencode }}" class="btn btn-success rounded-pill py-3 fw-bold shadow-sm">
                        <i class="bi bi-whatsapp me-2"></i>BOOK ON WHATSAPP
                    </a>
                    <a href="/enquiry/{{ villa.Villa_ID }}" class="btn btn-outline-primary rounded-pill py-3 fw-bold">
                        <i class="bi bi-envelope-paper me-2"></i>FILL ENQUIRY FORM
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="mobile-booking-bar d-md-none">
    <div style="flex: 1;">
        {% if villa.Price|int == 0 %}
            <div class="fw-bold fs-5 text-dark">Price on Request</div>
        {% else %}
            <div class="fw-bold fs-4 text-primary">â‚¹{{ villa.Price|int }}</div>
        {% endif %}
    </div>
    <div style="display: flex; gap: 10px;">
        <a href="/enquiry/{{ villa.Villa_ID }}" class="btn btn-outline-primary rounded-pill px-3 py-2 fw-bold"><i class="bi bi-pencil-square"></i></a>
        <a href="https://wa.me/918830024994?text=I%20want%20to%20book%20{{ villa.Villa_Name|urlencode }}" class="btn btn-success rounded-pill px-4 py-2 fw-bold shadow"><i class="bi bi-whatsapp"></i> BOOK</a>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const disabledDates = {{ booked_dates | tojson }};

        flatpickr("#check_availability", {
            inline: false, 
            minDate: "today",
            dateFormat: "Y-m-d",
            disable: disabledDates,
            mode: "range",
            static: true, 
            altInput: true,
            altFormat: "F j, Y",
            onDayCreate: function(dObj, dStr, fp, dayElem) {
                if (dayElem.classList.contains('disabled')) {
                    dayElem.title = "Sold Out";
                }
            }
        });
    });
</script>

{% endblock %}
