{% extends 'base.html' %}

{% block content %}
<div class="container py-5">
    <div class="mb-4 text-center">
        <a href="/gallery" class="btn btn-sm btn-outline-secondary rounded-pill mb-3">← Back to All Villas</a>
        <h1 class="fw-bold text-uppercase display-5">{{ villa_name }}</h1>
        <p class="text-muted">Explore every corner of your luxury stay</p>
        <hr class="mx-auto" style="width: 70px; height: 4px; background-color: #ffc107; border: none; border-radius: 10px;">
    </div>

    <div class="d-flex justify-content-center gap-2 mb-5 overflow-auto pb-2" id="filter-group">
        <button class="btn btn-dark rounded-pill px-4 filter-btn" data-filter="all">All Photos</button>
        <button class="btn btn-outline-dark rounded-pill px-4 filter-btn" data-filter="pool">Pool</button>
        <button class="btn btn-outline-dark rounded-pill px-4 filter-btn" data-filter="bedroom">Bedroom</button>
        <button class="btn btn-outline-dark rounded-pill px-4 filter-btn" data-filter="hall">Living Area</button>
    </div>

    <div class="row g-3" id="photo-grid">
        {% for p in photos %}
            {# यहाँ हम इमेज लिंक चेक कर रहे हैं #}
            {% set img_url = p.display_image if p.display_image else p.Image_Main %}
            
            {% if img_url %}
            <div class="col-md-4 col-sm-6 villa-photo-item all {{ p.Category | lower | trim }}">
                <div class="card border-0 shadow-sm rounded-4 overflow-hidden position-relative" style="height: 280px; cursor: pointer;" onclick="openLightbox('{{ img_url }}')">
                    <img src="{{ img_url }}" class="w-100 h-100" style="object-fit: cover; transition: 0.3s;" onmouseover="this.style.transform='scale(1.1)'" onmouseout="this.style.transform='scale(1)'">
                    <div class="position-absolute bottom-0 start-0 w-100 p-2 text-white bg-dark bg-opacity-50 small">
                        {{ p.Category }}
                    </div>
                </div>
            </div>
            {% endif %}
        {% endfor %}
    </div>
</div>

<div id="lightbox" class="fixed-top w-100 h-100 bg-dark bg-opacity-90 d-none flex-column align-items-center justify-content-center" style="z-index: 9999;" onclick="this.classList.add('d-none')">
    <span class="position-absolute top-0 end-0 m-4 text-white fs-1" style="cursor: pointer;">&times;</span>
    <img id="lightbox-img" class="img-fluid rounded shadow-lg" style="max-height: 85%;">
</div>

<script>
    // फिल्टर लॉजिक
    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            // बटन का रंग बदलो
            document.querySelectorAll('.filter-btn').forEach(b => {
                b.classList.replace('btn-dark', 'btn-outline-dark');
            });
            this.classList.replace('btn-outline-dark', 'btn-dark');

            const filterValue = this.getAttribute('data-filter').toLowerCase();
            const photos = document.querySelectorAll('.villa-photo-item');

            photos.forEach(photo => {
                if (filterValue === 'all' || photo.classList.contains(filterValue)) {
                    photo.style.display = 'block';
                } else {
                    photo.style.display = 'none';
                }
            });
        });
    });

    // फोटो बड़ा करने का फंक्शन
    function openLightbox(src) {
        document.getElementById('lightbox-img').src = src;
        document.getElementById('lightbox').classList.replace('d-none', 'd-flex');
    }
</script>
{% endblock %}
