{% extends 'base.html' %}
{% block content %}

<style>
    /* üè∑Ô∏è Discount Tag Style */
    .detail-discount-tag {
        position: absolute; top: 15px; right: 15px; z-index: 30;
        background: #0d6efd; color: white; padding: 6px 15px;
        border-radius: 50px; font-weight: 800; font-size: 0.9rem;
        box-shadow: 0 4px 15px rgba(13, 110, 253, 0.3);
    }

    /* Price Styling */
    .price-request-bold { color: #0d6efd; font-weight: 800; font-size: 1.8rem; text-transform: uppercase; letter-spacing: 1px; }
    .original-price-cut { text-decoration: line-through; color: #adb5bd; font-weight: 400; font-size: 1.2rem; margin-right: 10px; }
    .current-price-main { color: #0d6efd; font-weight: 800; font-size: 2rem; }

    /* Colorful Name for Detail Page */
    .villa-title-detail {
        background: linear-gradient(45deg, #ff416c, #ff4b2b);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        font-weight: 850;
    }

    /* Sticky Mobile Footer */
    @media (max-width: 767px) {
        .sticky-booking-bar {
            position: fixed; bottom: 0; left: 0; right: 0;
            background: white; padding: 15px 25px;
            box-shadow: 0 -10px 30px rgba(0,0,0,0.08);
            z-index: 1000; display: flex;
            justify-content: space-between; align-items: center;
            border-top: 1px solid #eee;
        }
        body { padding-bottom: 90px; } 
    }
    @media (min-width: 768px) { .sticky-booking-bar { display: none; } }

    .carousel-item img { height: 500px; object-fit: cover; border-radius: 20px; }
    @media (max-width: 768px) { .carousel-item img { height: 300px; } }

    .rule-item { border-left: 3px solid #0d6efd; padding-left: 15px; margin-bottom: 15px; background: #f8f9fa; padding-top: 10px; padding-bottom: 10px; border-radius: 0 10px 10px 0; }
    .info-card { background: #f0f7ff; border: 1px solid #cfe2ff; border-radius: 15px; padding: 20px; }
</style>

<div class="container py-4">
    <div id="villaSlider" class="carousel slide shadow-lg position-relative" data-bs-ride="carousel" style="border-radius: 25px; overflow: hidden;">
        {% set current = (villa.Price or 0) | float %}
        {% set original = (villa.Original_Price or 0) | float %}
        
        {% if original > current and current > 0 %}
            {% set disc = (((original - current) / original) * 100) | round | int %}
            <div class="detail-discount-tag">üî• {{ disc }}% OFF TODAY</div>
        {% endif %}

        <div class="carousel-inner">
            <div class="carousel-item active">
                <img src="{{ villa.Image_URL }}" class="d-block w-100" alt="Main">
            </div>
            {% if villa_images %}
                {% for img_url in villa_images %}
                    {% if img_url != villa.Image_URL %}
                    <div class="carousel-item">
                        <img src="{{ img_url }}" class="d-block w-100" alt="Gallery">
                    </div>
                    {% endif %}
                {% endfor %}
            {% endif %}
        </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#villaSlider" data-bs-slide="prev"><span class="carousel-control-prev-icon"></span></button>
        <button class="carousel-control-next" type="button" data-bs-target="#villaSlider" data-bs-slide="next"><span class="carousel-control-next-icon"></span></button>
    </div>

    <div class="row mt-5">
        <div class="col-md-8">
            <div class="d-flex align-items-center mb-2">
                <span class="badge bg-primary-subtle text-primary border border-primary-subtle rounded-pill px-3 py-1 me-2 small fw-bold">LUXURY STAY</span>
                <small class="text-muted"><i class="bi bi-geo-alt-fill text-danger"></i> Lonavala, Maharashtra</small>
            </div>
            <h1 class="villa-title-detail display-5 mb-4">{{ villa.Villa_Name }}</h1>

            <div class="mb-5 py-3 border-top border-bottom">
                {% if current > 0 %}
                    <span class="text-muted small d-block mb-1">Nightly Rate</span>
                    <div class="d-flex align-items-baseline">
                        {% if original > current %}
                            <span class="original-price-cut">‚Çπ{{ original | int }}</span>
                        {% endif %}
                        <span class="current-price-main">‚Çπ{{ current | int }}</span>
                        <small class="text-muted ms-2 fs-6">/ night</small>
                    </div>
                {% else %}
                    <div class="price-request-bold">Price on Request</div>
                {% endif %}
            </div>

            <div class="row g-3 mb-5 text-center">
                <div class="col-4">
                    <div class="p-3 border rounded-4 bg-white shadow-sm h-100">
                        <i class="bi bi-people fs-3 text-primary"></i>
                        <div class="small fw-bold mt-1">{{ villa.Guests }} Guests</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="p-3 border rounded-4 bg-white shadow-sm h-100">
                        <i class="bi bi-door-open fs-3 text-primary"></i>
                        <div class="small fw-bold mt-1">{{ villa.BHK }} BHK</div>
                    </div>
                </div>
                <div class="col-4">
                    <div class="p-3 border rounded-4 bg-white shadow-sm h-100">
                        <i class="bi bi-droplet fs-3 text-primary"></i>
                        <div class="small fw-bold mt-1">Pool</div>
                    </div>
                </div>
            </div>

            <div class="info-card mb-5">
                <h5 class="fw-bold"><i class="bi bi-info-circle-fill me-2"></i>About this Villa</h5>
                <p class="text-muted mb-0">{{ villa.Description or 'Experience luxury and tranquility in this beautiful villa located in the heart of Lonavala.' }}</p>
            </div>
        </div>

        <div class="col-md-4 d-none d-md-block">
            <div class="card border-0 shadow-lg rounded-4 p-4 sticky-top" style="top: 100px;">
                <h5 class="fw-bold mb-3">Ready to Book?</h5>
                <p class="small text-muted mb-4">Check availability and get the best seasonal offers for your dates.</p>
                <a href="/enquiry/{{ villa.Villa_ID }}" class="btn btn-primary w-100 rounded-pill py-3 fw-bold shadow">BOOK THIS VILLA</a>
                <div class="text-center mt-3">
                    <small class="text-muted"><i class="bi bi-shield-check me-1"></i> No payment required now</small>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="sticky-booking-bar">
    <div>
        {% if current > 0 %}
            <span class="fw-bold fs-5">‚Çπ{{ current | int }}</span>
            <small class="text-muted">/night</small>
        {% else %}
            <span class="fw-bold fs-6">Price on Request</span>
        {% endif %}
    </div>
    <a href="/enquiry/{{ villa.Villa_ID }}" class="btn btn-primary rounded-pill px-4 fw-bold">ENQUIRE</a>
</div>

{% endblock %}
